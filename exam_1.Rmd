---
title: "Exam 1"
author: "Westley Cook"
date: "2/22/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)

```

```{r read-paris-data, include=FALSE}

paris <- read_csv("raw-data/paris.csv") %>% 
  clean_names()

```

## Question 1

```{r question1.1, echo=FALSE}

country <- paris %>% 
  arrange(desc(emissions)) %>% 
  slice(1) %>% 
  pull(name)

```

1. The highest emissions are from the country **`r country`**.

```{r question1.2, echo=FALSE}

number_countries <- paris %>% 
  filter(kind != "Ratification") %>% 
  filter(kind != "Approval") %>% 
  count() %>% 
  pull(n)

```

2. The number of countries that have neither ratified nor approved of the treaty
is **`r number_countries`**.
*This number includes only countries who indicated acceptance or accession.*

```{r question1.3, echo=FALSE}

longest_days <- paris %>% 
  mutate(gap = ratification - signature) %>% 
  arrange(desc(gap)) %>% 
  slice(1) %>% 
  pull(gap)
  
```

3. The longest number of days between signature and ratification (for a country
that has successfully ratified) is **`r longest_days`** days.

```{r question1.4, echo=FALSE}

number_stan <- paris %>% 
  filter(str_detect(name, "stan"),
         kind == "Ratification") %>% 
  count() %>% 
  pull(n)

```

4. The number of ratifying countries whose name ends with “stan” is 
**`r number_stan`**.

```{r read-co2-data, include=FALSE}

emissions <- read_csv("raw-data/WB_co2_emisions.csv", 
                      skip = 4,
                      col_types = cols()) %>% 
  clean_names()

```

```{r question1.5, echo=FALSE}

highest_1960 <- emissions %>% 
  arrange(desc(x1960)) %>% 
  slice(1) %>% 
  pull(country_name)

```

5. In 1960, the country with the highest emissions was **`r highest_1960`**.

```{r question1.6, echo=FALSE}

avg2000 <- emissions %>% 
  summarize(avg_2000 = mean(x2000, na.rm = TRUE)) %>% 
  pull(avg_2000) %>% 
  round(digits = 2)

```
  
6. The average emissions in 2000 was **`r avg2000`** metric tons per capita.

## Question 2

```{r question2, echo=FALSE}

emissions_tidy <- emissions %>% 
pivot_longer(cols = c(x1960:x2019),
             names_to = "year",
             values_to = "emissions_per_captita",
             names_prefix = "x") %>% 
  type_convert(col_types = cols())
  

joined <- emissions_tidy %>% 
  left_join(paris,
             by = c("year", 
                    "country_code" = "code"))

# x %>% 
#   filter(year == "1960") %>% 
#   arrange(emissions_per_captita)
# 
# x %>% 
#   filter(year == "1960") %>% 
#   arrange(desc(emissions_per_captita))

date <- joined %>%
  filter(date_of_effect == "2016-11-04") %>%
  slice(1) %>%
  pull(date_of_effect)

joined %>% 
  filter(country_name == "United States" |
           country_name == "Canada" |
           country_name == "Mexico",
         emissions_per_captita != "NA") %>% 
  ggplot(aes(x = year,
             y = emissions_per_captita,
             color = country_name,
             group = country_name)) +
  geom_point() +
  geom_line() +
  geom_vline(xintercept = as.numeric(format(date, "%Y")),
             linetype = "dotted") +
  labs(title = "CO2 Emissions of North American Countries, 1960 - 2014",
       y = "Metric Tons Per Capita",
       x = "Year") +
  scale_color_discrete(name = "Country",
                       breaks = c("United States",
                                  "Canada",
                                  "Mexico")) +
  scale_x_continuous(breaks = seq(1960,
                                  2020,
                                  by = 10),
                     labels = c("1960",
                                "1970",
                                "1980",
                                "1990",
                                "2000",
                                "2010",
                                "2020")
                     ) +
  theme_classic() +
  annotate("text",
           x = 2016, 
           y = 9, 
           label = "Year Paris Accord\nTook Effect (2016)",
           color = "gray28",
           size =3.5,
           angle = 90)

```


## Question 3







